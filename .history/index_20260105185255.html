<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Trang Ch·ªß</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#EF4444",
              "background-light": "#FFFBF0",
              "background-dark": "#101622",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.25rem",
              lg: "0.5rem",
              xl: "0.75rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
      .dropdown-menu {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }
      .dropdown-menu.show {
        display: block;
      }
    </style>
  </head>
  <body
    class="font-display bg-background-light dark:bg-background-dark text-gray-800 dark:text-gray-900"
  >
    <div
      class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden"
    >
      <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
        <img
          alt="Hoa Mai"
          class="absolute top-0 left-0 w-24 md:w-48 opacity-80"
          src="https://lh3.googleusercontent.com/aida-public/AB6AXuDTSWoDW5HSGnj0rjVGoTNZeRlQag6ZdWpRRyUCTsB92l8zcbinNUmmehbuHcodoroFg-zEke9UPPSJBusqg2wKS4g3eCb5TO6h-chaKEW-XtaAQDDpX9oFRsX9udGCSSTK8_GKAlFDh77MK38oivKZCN9LRLPc3fdMDLpuDuZ3BvryPCjnC8yZUu-oDFgSKpvtW0ZBlkohJNs32IqTDv5z6EHzRNtxPJdO0NqEkOQpOC_BHFA3NrO-G_3zcx4Rtj_kb8rOEg21yJ8"
        />
        <img
          alt="Hoa ƒê√†o"
          class="absolute top-0 right-0 w-24 md:w-48 opacity-80"
          src="https://lh3.googleusercontent.com/aida-public/AB6AXuDnq7dQxHFtOV03uBzTEXjfF40DOL3zDAoOBX4et-ftu2FWMbOv7qjAeAiMK_Q4UaM7_Ob7XU2R56UFMqJuPm8Aq20ZDDXBS0m--TuTxmWp8Z-JicANp52XLi5bKVWko0A-O-8-YSIpaLzPell4gIO8If_HFqNUFlYi9xr7NJCL7fe3i5LX4iIbpVOjlQmqm2_eljywVeI0kHVdt2kcr44RQXdTvV2mqr4HwxtI0gu8RbNJD805TVs1hu68fWK3vnqBh0m8bhQ9Moo"
        />
      </div>
      <header
        class="sticky top-0 z-50 w-full bg-[#FFEFCF] border-b border-yellow-300/50"
      >
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex h-16 items-center justify-between">
            <div class="flex items-center gap-4 text-red-600">
              <div class="h-8 w-8 text-primary">
                <svg
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M16.8,6.28l-1.65,1.1L16.28,9l-1.65,1.1,1.1,1.65L17,10.1l1.1,1.65,1.65-1.1L18.1,9l1.65-1.1-1.1-1.65L17,7.9l-1.1-1.62ZM22,12l-2.67-2L18,7.33,15.33,6,14,4.67,12,2,9.33,4.67,8,6,5.33,7.33,4,10,2,12l2,2.67,1.33,2.67L8,20l2.67,1.33L12,24l2.67-2.67L16,20l2.67-1.33L20,14.67,22,12ZM16,15.33,14.67,18,12,20.67,9.33,18,8,15.33,5.33,14,4.67,12,7.33,9.33,10,8,12,5.33,14.67,8,17.33,10.67,18,12l-2,2.67Z"
                  ></path>
                </svg>
              </div>
              <h2
                class="text-red-700 text-xl font-black leading-tight tracking-[-0.015em] drop-shadow-sm"
              >
                Logo
              </h2>
            </div>

            <!-- Auth Buttons (khi ch∆∞a ƒëƒÉng nh·∫≠p) -->
            <div class="auth-buttons hidden md:flex items-center gap-2">
              <a
                href="pages/login.html"
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-red-100 hover:bg-red-200/80 transition-colors text-red-800 text-sm font-bold leading-normal tracking-[0.015em]"
              >
                <span class="truncate">ƒêƒÉng Nh·∫≠p</span>
              </a>
              <a
                href="/pages/register.html"
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary hover:bg-primary/90 transition-colors text-white text-sm font-bold leading-normal tracking-[0.015em]"
              >
                <span class="truncate">ƒêƒÉng K√Ω</span>
              </a>
            </div>

            <!-- User Menu (khi ƒë√£ ƒëƒÉng nh·∫≠p) -->
            <div class="user-menu hidden md:flex items-center gap-4 relative">
              <div class="flex items-center gap-3 px-4 py-2 bg-red-100 rounded-lg hover:bg-red-200/80 transition-colors cursor-pointer" onclick="toggleDropdown()">
                <img
                  src="https://ui-avatars.com/api/?name=User&background=EF4444&color=fff"
                  alt="Avatar"
                  class="user-avatar w-8 h-8 rounded-full"
                />
                <span class="user-name text-red-800 text-sm font-bold">Ng∆∞·ªùi d√πng</span>
                <span class="material-symbols-outlined text-red-800">expand_more</span>
              </div>

              <!-- Dropdown Menu -->
              <div id="userDropdown" class="dropdown-menu w-48 mt-2">
                <a href="index.html" class="block px-4 py-2 text-gray-800 hover:bg-red-50">üè† Trang ch·ªß</a>
                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-red-50">‚ûï T·∫°o phong bao</a>
                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-red-50">üì¨ Phong bao ƒë√£ nh·∫≠n</a>
                <hr class="my-2" />
                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-red-50">‚öôÔ∏è C√†i ƒë·∫∑t</a>
                <button onclick="handleLogout()" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 font-bold">üö™ ƒêƒÉng xu·∫•t</button>
              </div>
            </div>

            <div class="md:hidden">
              <button
                class="inline-flex items-center justify-center rounded-lg p-2 text-red-700 hover:bg-red-100/50 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-500"
              >
                <span class="material-symbols-outlined">menu</span>
              </button>
            </div>
          </div>
        </div>
      </header>
      <main
        class="flex flex-1 items-center justify-center py-12 sm:py-16 md:py-24 z-10"
      >
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-center">
            <div class="w-full max-w-2xl" id="app">
              <!-- App Views -->
              <div
                class="relative flex flex-col gap-6 rounded-xl border-2 border-yellow-400 bg-red-600 p-6 sm:p-8 shadow-2xl overflow-hidden"
              >
                <div class="absolute inset-0 opacity-10 pointer-events-none">
                  <img
                    alt="fireworks"
                    class="absolute -top-10 -left-10 w-40 h-40"
                    src="https://lh3.googleusercontent.com/aida-public/AB6AXuC8JxbV5Lh3UjfpsUZOjms1SI4EU01XSKOf-ssATQQpcDw8clflsPk-2Us_v1M0LdJoLvwB2tfl39hHhA2sKgqNZVbC2doBxqOyCC3hLo7cpMZCB9_fMycSZ_H0LBvQk6fNH3c-b-2YgLke-odmHw5l4EPIgmtbPwvBOsYAWz4DqHWUY38ng3gFLxkS5s0oGoNCr8Nt00AkK6hyb-_UkVWu7X1hWPILlozzmWQVm37RU7MhfMu6t0UlS7Wz9IZYDGdp_lF8TzbPv0Q"
                  />
                  <img
                    alt="fireworks"
                    class="absolute -bottom-12 -right-12 w-48 h-48"
                    src="https://lh3.googleusercontent.com/aida-public/AB6AXuDlK8dh_Mg28FlU0J_ZjAXM0trek1QYb3dpwMGcB4Pe4a_hagJPz3ZbvQs4m7spGZtbmMVDqvELfrZKoKP3hw3DEcr7i1eNgNVagIOyLySHC-MkSXoSm8D4MqVETkoXCGCHQikwKBegUvyso-BtR67LoDNJk_xZZHirRQObNAui3zaRiXYUxZ0Xrf0zMTUzVYAxLMgCs2F2LnYKkIiR6J0X2YxWdxRx3VuGewhE6MiA-dbKk0GyaQi18HN6KxJewg6ucDnYWfCG2wc"
                  />
                </div>
                <div class="absolute -top-2 -left-2 w-16 h-16">
                  <img
                    alt="mai flower corner"
                    src="https://lh3.googleusercontent.com/aida-public/AB6AXuD7KAHFcUhv7ghGtsHMTqbE5q10dc--H8aG3FlJfpjRWP9gahdY8voqJjdcG0urmLCILvizrBieo90taSH6C-D7gvT40LlayguGgQM2otfxrvqQ8u1yT-H6x5BJdhWxnz_ycRZcOPCJVovBH_deppCnAanuycZqy1ptAuOhvE73KdA79UzRionPFtljNm4igQDvlTsuvgF6fFFfso0eEx9_HFco3C1R9NvnUlKSp0jbSFO2dIJfkidNAYNxvDF3R1_fpBXSYDLAIoo"
                  />
                </div>
                <div
                  class="absolute -bottom-2 -right-2 w-16 h-16 transform scale-x-[-1]"
                >
                  <img
                    alt="mai flower corner"
                    src="https://lh3.googleusercontent.com/aida-public/AB6AXuCtG4sjgAxPpCvMtDC7HEOZ2K75Rqh7PW718ZI9Y-jc6OerPn380hANJtrEkw4vMHAcYWAiRZXWF8eVzngwdvZxI9usdL849M1ge4JC72kmn4A3lQQAE5RijJNlS36UoUBcibeUnirQHJwlQrWBZHACa_GoRfRebQiDbRy5Ox9ZRgduK8elH_PqSInqB9hFRZPLBWExU6KXNHeocTFCrbTqWBHYgIQy28GGrkCctcZGDXmVOTZX4hWXfFVCfP9x3EUFrnwOx9fVyxY"
                  />
                </div>
                
                <!-- Header -->
                <div class="flex flex-col gap-2 text-center z-10">
                  <h1
                    class="text-yellow-300 text-3xl sm:text-4xl font-black leading-tight tracking-[-0.033em] drop-shadow-md"
                  >
                    üéÅ T·∫°o Phong B√¨ M·ªõi
                  </h1>
                  <p class="text-yellow-100 text-base font-normal leading-normal">
                    T·∫°o m·ªôt phong b√¨ t·∫øt ƒë·ªÉ g·ª≠i l·ªùi ch√∫c t·ªët ƒë·∫πp ƒë·∫øn ng∆∞·ªùi th√¢n y√™u
                  </p>
                </div>

                <!-- Form -->
                <form id="createEnvelopeForm" class="relative z-10 flex flex-col gap-4">
                  <!-- T√™n ng∆∞·ªùi nh·∫≠n -->
                  <div class="flex flex-col gap-2">
                    <label
                      for="recipientName"
                      class="text-white text-sm font-bold leading-normal"
                    >
                      üë§ T√™n ng∆∞·ªùi nh·∫≠n
                    </label>
                    <input
                      type="text"
                      id="recipientName"
                      placeholder="Nh·∫≠p t√™n ng∆∞·ªùi nh·∫≠n"
                      class="block w-full rounded-lg border border-yellow-300 bg-yellow-50 px-4 py-2.5 text-sm text-gray-900 focus:border-yellow-400 focus:ring-yellow-400 placeholder:text-gray-500"
                      required
                    />
                  </div>

                  <!-- S·ªë ti·ªÅn -->
                  <div class="flex flex-col gap-2">
                    <label
                      for="amount"
                      class="text-white text-sm font-bold leading-normal"
                    >
                      üí∞ S·ªë ti·ªÅn (VNƒê)
                    </label>
                    <input
                      type="number"
                      id="amount"
                      placeholder="Nh·∫≠p s·ªë ti·ªÅn"
                      min="10000"
                      step="10000"
                      class="block w-full rounded-lg border border-yellow-300 bg-yellow-50 px-4 py-2.5 text-sm text-gray-900 focus:border-yellow-400 focus:ring-yellow-400 placeholder:text-gray-500"
                      required
                    />
                  </div>

                  <!-- L·ªùi ch√∫c -->
                  <div class="flex flex-col gap-2">
                    <label
                      for="message"
                      class="text-white text-sm font-bold leading-normal"
                    >
                      üíå L·ªùi ch√∫c
                    </label>
                    <textarea
                      id="message"
                      placeholder="Nh·∫≠p l·ªùi ch√∫c (t·ªëi ƒëa 200 k√Ω t·ª±)"
                      maxlength="200"
                      rows="4"
                      class="block w-full rounded-lg border border-yellow-300 bg-yellow-50 px-4 py-2.5 text-sm text-gray-900 focus:border-yellow-400 focus:ring-yellow-400 placeholder:text-gray-500 resize-none"
                    ></textarea>
                    <div class="text-yellow-100 text-xs font-normal">
                      <span id="charCount">0</span>/200 k√Ω t·ª±
                    </div>
                  </div>

                  <!-- Ch·ªçn m·∫´u -->
                  <div class="flex flex-col gap-2">
                    <label
                      for="template"
                      class="text-white text-sm font-bold leading-normal"
                    >
                      üé® M·∫´u phong b√¨
                    </label>
                    <select
                      id="template"
                      class="block w-full rounded-lg border border-yellow-300 bg-yellow-50 px-4 py-2.5 text-sm text-gray-900 focus:border-yellow-400 focus:ring-yellow-400"
                    >
                      <option value="classic">üéä C·ªï ƒëi·ªÉn</option>
                      <option value="modern">‚ú® Hi·ªán ƒë·∫°i</option>
                      <option value="elegant">üåü Sang tr·ªçng</option>
                      <option value="colorful">üåà S·∫∑c s·ª°</option>
                    </select>
                  </div>

                  <!-- N√∫t t·∫°o -->
                  <div class="flex gap-3 pt-2">
                    <button
                      type="submit"
                      class="flex flex-1 min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-6 bg-yellow-400 hover:bg-yellow-300 transition-colors text-red-800 text-sm font-bold leading-normal tracking-[0.015em] shadow-lg"
                    >
                      <span class="truncate">üì¨ T·∫°o Phong B√¨</span>
                    </button>
                    <button
                      type="button"
                      onclick="viewEnvelopes()"
                      class="flex flex-1 min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-6 bg-yellow-100 hover:bg-yellow-200 transition-colors text-red-800 text-sm font-bold leading-normal tracking-[0.015em]"
                    >
                      <span class="truncate">üìã Xem Danh S√°ch</span>
                    </button>
                  </div>

                  <!-- Th√¥ng b√°o -->
                  <div
                    id="formMessage"
                    class="hidden text-center text-sm font-medium p-3 rounded-lg"
                  ></div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </main>
      <script src="auth.js"></script>
      <script src="script.js"></script>
      <script>
        // C·∫≠p nh·∫≠t UI khi trang t·∫£i
        document.addEventListener("DOMContentLoaded", function() {
          updateAuthUI();
          setupEnvelopeForm();
        });

        // Setup form t·∫°o phong b√¨
        function setupEnvelopeForm() {
          const form = document.getElementById("createEnvelopeForm");
          const messageInput = document.getElementById("message");
          const charCount = document.getElementById("charCount");

          // C·∫≠p nh·∫≠t k√Ω t·ª± ƒë√£ nh·∫≠p
          if (messageInput) {
            messageInput.addEventListener("input", function() {
              charCount.textContent = this.value.length;
            });
          }

          // X·ª≠ l√Ω submit form
          if (form) {
            form.addEventListener("submit", async function(e) {
              e.preventDefault();
              await createEnvelope();
            });
          }
        }

        // T·∫°o phong b√¨
        async function createEnvelope() {
          const recipientName = document.getElementById("recipientName").value.trim();
          const amount = document.getElementById("amount").value;
          const message = document.getElementById("message").value.trim();
          const template = document.getElementById("template").value;
          const formMessage = document.getElementById("formMessage");

          // Validate
          if (!recipientName || !amount) {
            showFormMessage("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!", "error");
            return;
          }

          if (amount < 10000) {
            showFormMessage("S·ªë ti·ªÅn t·ªëi thi·ªÉu l√† 10,000 VNƒê!", "error");
            return;
          }

          try {
            const token = AuthManager.getToken();
            if (!token) {
              showFormMessage("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ t·∫°o phong b√¨!", "error");
              return;
            }

            const response = await fetch(`${AuthManager.API_URL}/envelope/create`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
              },
              body: JSON.stringify({
                recipientName,
                amount: parseInt(amount),
                message: message || "",
                template
              })
            });

            const data = await response.json();

            if (!response.ok || data.success === false) {
              throw new Error(data.message || "L·ªói khi t·∫°o phong b√¨");
            }

            showFormMessage("‚úÖ Phong b√¨ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!", "success");
            document.getElementById("createEnvelopeForm").reset();
            document.getElementById("charCount").textContent = "0";
          } catch (error) {
            showFormMessage("‚ùå " + error.message, "error");
          }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o form
        function showFormMessage(message, type) {
          const messageDiv = document.getElementById("formMessage");
          messageDiv.textContent = message;
          messageDiv.className = `${type === "success" ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"} text-center text-sm font-medium p-3 rounded-lg`;
          messageDiv.classList.remove("hidden");

          setTimeout(() => {
            messageDiv.classList.add("hidden");
          }, 3000);
        }

        // Xem danh s√°ch phong b√¨
        function viewEnvelopes() {
          // TODO: Chuy·ªÉn sang view danh s√°ch phong b√¨
          alert("Ch·ª©c nƒÉng xem danh s√°ch phong b√¨ s·∫Øp ra m·∫Øt!");
        }

        // Toggle dropdown menu
        function toggleDropdown() {
          const dropdown = document.getElementById("userDropdown");
          dropdown.classList.toggle("show");
        }

        // ƒê√≥ng dropdown khi click ngo√†i
        document.addEventListener("click", function (event) {
          const dropdown = document.getElementById("userDropdown");
          const userMenu = document.querySelector(".user-menu");
          if (userMenu && !userMenu.contains(event.target)) {
            dropdown.classList.remove("show");
          }
        });

        // ƒêƒÉng xu·∫•t
        function handleLogout() {
          if (confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?")) {
            AuthManager.logout();
          }
        }
      </script>
    </div>
  </body>
</html>
